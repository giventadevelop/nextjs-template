/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/webhooks/stripe/route";
exports.ids = ["app/api/webhooks/stripe/route"];
exports.modules = {

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fwebhooks%2Fstripe%2Froute&page=%2Fapi%2Fwebhooks%2Fstripe%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fwebhooks%2Fstripe%2Froute.ts&appDir=C%3A%5CUsers%5Cgain%5Cgit%5Cnextjs-template%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cgain%5Cgit%5Cnextjs-template&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fwebhooks%2Fstripe%2Froute&page=%2Fapi%2Fwebhooks%2Fstripe%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fwebhooks%2Fstripe%2Froute.ts&appDir=C%3A%5CUsers%5Cgain%5Cgit%5Cnextjs-template%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cgain%5Cgit%5Cnextjs-template&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_gain_git_nextjs_template_src_app_api_webhooks_stripe_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/webhooks/stripe/route.ts */ \"(rsc)/./src/app/api/webhooks/stripe/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/webhooks/stripe/route\",\n        pathname: \"/api/webhooks/stripe\",\n        filename: \"route\",\n        bundlePath: \"app/api/webhooks/stripe/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\gain\\\\git\\\\nextjs-template\\\\src\\\\app\\\\api\\\\webhooks\\\\stripe\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_gain_git_nextjs_template_src_app_api_webhooks_stripe_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIvaW5kZXguanM/bmFtZT1hcHAlMkZhcGklMkZ3ZWJob29rcyUyRnN0cmlwZSUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGd2ViaG9va3MlMkZzdHJpcGUlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZ3ZWJob29rcyUyRnN0cmlwZSUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNnYWluJTVDZ2l0JTVDbmV4dGpzLXRlbXBsYXRlJTVDc3JjJTVDYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj1DJTNBJTVDVXNlcnMlNUNnYWluJTVDZ2l0JTVDbmV4dGpzLXRlbXBsYXRlJmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUErRjtBQUN2QztBQUNxQjtBQUNnQztBQUM3RztBQUNBO0FBQ0E7QUFDQSx3QkFBd0IseUdBQW1CO0FBQzNDO0FBQ0EsY0FBYyxrRUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLHNEQUFzRDtBQUM5RDtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUMwRjs7QUFFMUYiLCJzb3VyY2VzIjpbIiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiQzpcXFxcVXNlcnNcXFxcZ2FpblxcXFxnaXRcXFxcbmV4dGpzLXRlbXBsYXRlXFxcXHNyY1xcXFxhcHBcXFxcYXBpXFxcXHdlYmhvb2tzXFxcXHN0cmlwZVxcXFxyb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvd2ViaG9va3Mvc3RyaXBlL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvd2ViaG9va3Mvc3RyaXBlXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS93ZWJob29rcy9zdHJpcGUvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCJDOlxcXFxVc2Vyc1xcXFxnYWluXFxcXGdpdFxcXFxuZXh0anMtdGVtcGxhdGVcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxcd2ViaG9va3NcXFxcc3RyaXBlXFxcXHJvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgd29ya0FzeW5jU3RvcmFnZSwgd29ya1VuaXRBc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgd29ya0FzeW5jU3RvcmFnZSxcbiAgICAgICAgd29ya1VuaXRBc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCB3b3JrQXN5bmNTdG9yYWdlLCB3b3JrVW5pdEFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fwebhooks%2Fstripe%2Froute&page=%2Fapi%2Fwebhooks%2Fstripe%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fwebhooks%2Fstripe%2Froute.ts&appDir=C%3A%5CUsers%5Cgain%5Cgit%5Cnextjs-template%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cgain%5Cgit%5Cnextjs-template&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(rsc)/./src/app/api/webhooks/stripe/route.ts":
/*!**********************************************!*\
  !*** ./src/app/api/webhooks/stripe/route.ts ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   bodyParser: () => (/* binding */ bodyParser),\n/* harmony export */   runtime: () => (/* binding */ runtime)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var stripe__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! stripe */ \"(rsc)/./node_modules/stripe/esm/stripe.esm.node.js\");\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/prisma */ \"(rsc)/./src/lib/prisma.ts\");\n\n\n\n// Configure for Node.js runtime\nconst runtime = 'nodejs';\n// Disable Next.js body parsing\nconst bodyParser = false;\nconst stripe = new stripe__WEBPACK_IMPORTED_MODULE_1__[\"default\"](process.env.STRIPE_SECRET_KEY, {\n    apiVersion: \"2023-10-16\"\n});\nconst webhookSecret = process.env.STRIPE_WEBHOOK_SECRET;\nasync function POST(req) {\n    try {\n        const signature = req.headers.get(\"stripe-signature\");\n        if (!signature) {\n            console.error(\"No stripe signature found in headers\");\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"No stripe signature found\"\n            }, {\n                status: 400\n            });\n        }\n        const rawBody = await req.text();\n        if (!rawBody) {\n            console.error(\"Empty request body received\");\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Empty request body\"\n            }, {\n                status: 400\n            });\n        }\n        let event;\n        try {\n            event = stripe.webhooks.constructEvent(rawBody, signature, webhookSecret);\n            console.log(`Webhook received: ${event.type} (ID: ${event.id})`);\n        } catch (err) {\n            const error = err;\n            console.error('Webhook signature verification failed:', {\n                error: error.message,\n                signature: signature.slice(0, 10) + '...',\n                bodyLength: rawBody.length\n            });\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: `Webhook Error: ${error.message}`\n            }, {\n                status: 400\n            });\n        }\n        // Check if we've already processed this event\n        const processedEvent = await _lib_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.processedStripeEvent.findUnique({\n            where: {\n                eventId: event.id\n            }\n        });\n        if (processedEvent) {\n            console.log(`Event ${event.id} already processed, skipping`);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                received: true\n            });\n        }\n        // Handle subscription events\n        if (event.type === \"customer.subscription.created\" || event.type === \"customer.subscription.updated\" || event.type === \"customer.subscription.deleted\") {\n            const subscription = event.data.object;\n            const customerId = subscription.customer;\n            const userId = subscription.metadata.userId;\n            if (!userId) {\n                console.error('No userId found in subscription metadata', {\n                    subscriptionId: subscription.id,\n                    customerId\n                });\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"No userId found in subscription metadata\"\n                }, {\n                    status: 200\n                });\n            }\n            console.log(`Processing subscription event: ${event.type}`, {\n                customerId,\n                userId,\n                eventId: event.id,\n                subscriptionStatus: subscription.status\n            });\n            try {\n                // Use a transaction to ensure both operations succeed or fail together\n                await _lib_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.$transaction([\n                    // Update the subscription\n                    _lib_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.subscription.update({\n                        where: {\n                            userId\n                        },\n                        data: {\n                            status: subscription.status,\n                            stripeCustomerId: customerId,\n                            stripeSubscriptionId: subscription.id,\n                            stripePriceId: subscription.items.data[0]?.price.id,\n                            stripeCurrentPeriodEnd: new Date(subscription.current_period_end * 1000)\n                        }\n                    }),\n                    // Mark the event as processed\n                    _lib_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.processedStripeEvent.create({\n                        data: {\n                            eventId: event.id,\n                            type: event.type,\n                            processedAt: new Date()\n                        }\n                    })\n                ]);\n                console.log(`Successfully processed subscription event ${event.id}`);\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    received: true\n                });\n            } catch (dbError) {\n                console.error(\"Database operation failed:\", dbError);\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"Failed to update subscription in database\"\n                }, {\n                    status: 200\n                });\n            }\n        }\n        // Handle event ticket purchase completion\n        if (event.type === \"checkout.session.completed\") {\n            const session = event.data.object;\n            // Handle successful payment for event tickets\n            if (session.mode === \"payment\" && session.metadata?.eventId) {\n                const { eventId, ticketDetails } = session.metadata;\n                const parsedTickets = JSON.parse(ticketDetails);\n                try {\n                    await _lib_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.$transaction([\n                        ...parsedTickets.map((ticket)=>_lib_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.ticketTransaction.create({\n                                data: {\n                                    eventId: eventId,\n                                    email: session.customer_email || '',\n                                    ticketType: ticket.type,\n                                    quantity: ticket.quantity,\n                                    pricePerUnit: ticket.price,\n                                    totalAmount: ticket.price * ticket.quantity,\n                                    status: 'completed',\n                                    purchaseDate: new Date()\n                                }\n                            }))\n                    ]);\n                } catch (error) {\n                    console.error('Error creating ticket transactions:', error);\n                    throw error;\n                }\n            }\n        }\n        // For other event types, just acknowledge receipt\n        console.log(`Successfully received webhook event: ${event.type} (ID: ${event.id})`);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            received: true\n        });\n    } catch (error) {\n        console.error(\"Error processing webhook:\", error);\n        // Return 200 for general errors to prevent retries\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Internal server error\"\n        }, {\n            status: 200\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS93ZWJob29rcy9zdHJpcGUvcm91dGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQTJDO0FBQ2Y7QUFDVTtBQUV0QyxnQ0FBZ0M7QUFDekIsTUFBTUcsVUFBVSxTQUFTO0FBRWhDLCtCQUErQjtBQUN4QixNQUFNQyxhQUFhLE1BQU07QUFFaEMsTUFBTUMsU0FBUyxJQUFJSiw4Q0FBTUEsQ0FBQ0ssUUFBUUMsR0FBRyxDQUFDQyxpQkFBaUIsRUFBRztJQUN4REMsWUFBWTtBQUNkO0FBRUEsTUFBTUMsZ0JBQWdCSixRQUFRQyxHQUFHLENBQUNJLHFCQUFxQjtBQUVoRCxlQUFlQyxLQUFLQyxHQUFZO0lBQ3JDLElBQUk7UUFDRixNQUFNQyxZQUFZRCxJQUFJRSxPQUFPLENBQUNDLEdBQUcsQ0FBQztRQUVsQyxJQUFJLENBQUNGLFdBQVc7WUFDZEcsUUFBUUMsS0FBSyxDQUFDO1lBQ2QsT0FBT2xCLHFEQUFZQSxDQUFDbUIsSUFBSSxDQUN0QjtnQkFBRUQsT0FBTztZQUE0QixHQUNyQztnQkFBRUUsUUFBUTtZQUFJO1FBRWxCO1FBRUEsTUFBTUMsVUFBVSxNQUFNUixJQUFJUyxJQUFJO1FBRTlCLElBQUksQ0FBQ0QsU0FBUztZQUNaSixRQUFRQyxLQUFLLENBQUM7WUFDZCxPQUFPbEIscURBQVlBLENBQUNtQixJQUFJLENBQ3RCO2dCQUFFRCxPQUFPO1lBQXFCLEdBQzlCO2dCQUFFRSxRQUFRO1lBQUk7UUFFbEI7UUFFQSxJQUFJRztRQUVKLElBQUk7WUFDRkEsUUFBUWxCLE9BQU9tQixRQUFRLENBQUNDLGNBQWMsQ0FDcENKLFNBQ0FQLFdBQ0FKO1lBRUZPLFFBQVFTLEdBQUcsQ0FBQyxDQUFDLGtCQUFrQixFQUFFSCxNQUFNSSxJQUFJLENBQUMsTUFBTSxFQUFFSixNQUFNSyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ2pFLEVBQUUsT0FBT0MsS0FBSztZQUNaLE1BQU1YLFFBQVFXO1lBQ2RaLFFBQVFDLEtBQUssQ0FBQywwQ0FB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bURBQW1EO1FBQ25ELE9BQU9sQixxREFBWUEsQ0FBQ21CLElBQUksQ0FDdEI7WUFBRUQsT0FBTztRQUF3QixHQUNqQztZQUFFRSxRQUFRO1FBQUk7SUFFbEI7QUFDRiIsInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxnYWluXFxnaXRcXG5leHRqcy10ZW1wbGF0ZVxcc3JjXFxhcHBcXGFwaVxcd2ViaG9va3NcXHN0cmlwZVxccm91dGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSBcIm5leHQvc2VydmVyXCI7XG5pbXBvcnQgU3RyaXBlIGZyb20gXCJzdHJpcGVcIjtcbmltcG9ydCB7IHByaXNtYSB9IGZyb20gXCJAL2xpYi9wcmlzbWFcIjtcblxuLy8gQ29uZmlndXJlIGZvciBOb2RlLmpzIHJ1bnRpbWVcbmV4cG9ydCBjb25zdCBydW50aW1lID0gJ25vZGVqcyc7XG5cbi8vIERpc2FibGUgTmV4dC5qcyBib2R5IHBhcnNpbmdcbmV4cG9ydCBjb25zdCBib2R5UGFyc2VyID0gZmFsc2U7XG5cbmNvbnN0IHN0cmlwZSA9IG5ldyBTdHJpcGUocHJvY2Vzcy5lbnYuU1RSSVBFX1NFQ1JFVF9LRVkhLCB7XG4gIGFwaVZlcnNpb246IFwiMjAyMy0xMC0xNlwiIGFzIFN0cmlwZS5MYXRlc3RBcGlWZXJzaW9uLFxufSk7XG5cbmNvbnN0IHdlYmhvb2tTZWNyZXQgPSBwcm9jZXNzLmVudi5TVFJJUEVfV0VCSE9PS19TRUNSRVQhO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXE6IFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBzaWduYXR1cmUgPSByZXEuaGVhZGVycy5nZXQoXCJzdHJpcGUtc2lnbmF0dXJlXCIpO1xuXG4gICAgaWYgKCFzaWduYXR1cmUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJObyBzdHJpcGUgc2lnbmF0dXJlIGZvdW5kIGluIGhlYWRlcnNcIik7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6IFwiTm8gc3RyaXBlIHNpZ25hdHVyZSBmb3VuZFwiIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCByYXdCb2R5ID0gYXdhaXQgcmVxLnRleHQoKTtcblxuICAgIGlmICghcmF3Qm9keSkge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVtcHR5IHJlcXVlc3QgYm9keSByZWNlaXZlZFwiKTtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogXCJFbXB0eSByZXF1ZXN0IGJvZHlcIiB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgbGV0IGV2ZW50OiBTdHJpcGUuRXZlbnQ7XG5cbiAgICB0cnkge1xuICAgICAgZXZlbnQgPSBzdHJpcGUud2ViaG9va3MuY29uc3RydWN0RXZlbnQoXG4gICAgICAgIHJhd0JvZHksXG4gICAgICAgIHNpZ25hdHVyZSxcbiAgICAgICAgd2ViaG9va1NlY3JldFxuICAgICAgKTtcbiAgICAgIGNvbnNvbGUubG9nKGBXZWJob29rIHJlY2VpdmVkOiAke2V2ZW50LnR5cGV9IChJRDogJHtldmVudC5pZH0pYCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjb25zdCBlcnJvciA9IGVyciBhcyBFcnJvcjtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1dlYmhvb2sgc2lnbmF0dXJlIHZlcmlmaWNhdGlvbiBmYWlsZWQ6Jywge1xuICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSxcbiAgICAgICAgc2lnbmF0dXJlOiBzaWduYXR1cmUuc2xpY2UoMCwgMTApICsgJy4uLicsXG4gICAgICAgIGJvZHlMZW5ndGg6IHJhd0JvZHkubGVuZ3RoLFxuICAgICAgfSk7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6IGBXZWJob29rIEVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgaWYgd2UndmUgYWxyZWFkeSBwcm9jZXNzZWQgdGhpcyBldmVudFxuICAgIGNvbnN0IHByb2Nlc3NlZEV2ZW50ID0gYXdhaXQgcHJpc21hLnByb2Nlc3NlZFN0cmlwZUV2ZW50LmZpbmRVbmlxdWUoe1xuICAgICAgd2hlcmU6IHsgZXZlbnRJZDogZXZlbnQuaWQgfSxcbiAgICB9KTtcblxuICAgIGlmIChwcm9jZXNzZWRFdmVudCkge1xuICAgICAgY29uc29sZS5sb2coYEV2ZW50ICR7ZXZlbnQuaWR9IGFscmVhZHkgcHJvY2Vzc2VkLCBza2lwcGluZ2ApO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgcmVjZWl2ZWQ6IHRydWUgfSk7XG4gICAgfVxuXG4gICAgLy8gSGFuZGxlIHN1YnNjcmlwdGlvbiBldmVudHNcbiAgICBpZiAoZXZlbnQudHlwZSA9PT0gXCJjdXN0b21lci5zdWJzY3JpcHRpb24uY3JlYXRlZFwiIHx8XG4gICAgICBldmVudC50eXBlID09PSBcImN1c3RvbWVyLnN1YnNjcmlwdGlvbi51cGRhdGVkXCIgfHxcbiAgICAgIGV2ZW50LnR5cGUgPT09IFwiY3VzdG9tZXIuc3Vic2NyaXB0aW9uLmRlbGV0ZWRcIikge1xuICAgICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gZXZlbnQuZGF0YS5vYmplY3QgYXMgU3RyaXBlLlN1YnNjcmlwdGlvbjtcbiAgICAgIGNvbnN0IGN1c3RvbWVySWQgPSBzdWJzY3JpcHRpb24uY3VzdG9tZXIgYXMgc3RyaW5nO1xuICAgICAgY29uc3QgdXNlcklkID0gc3Vic2NyaXB0aW9uLm1ldGFkYXRhLnVzZXJJZDtcblxuICAgICAgaWYgKCF1c2VySWQpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignTm8gdXNlcklkIGZvdW5kIGluIHN1YnNjcmlwdGlvbiBtZXRhZGF0YScsIHtcbiAgICAgICAgICBzdWJzY3JpcHRpb25JZDogc3Vic2NyaXB0aW9uLmlkLFxuICAgICAgICAgIGN1c3RvbWVySWQsXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgeyBlcnJvcjogXCJObyB1c2VySWQgZm91bmQgaW4gc3Vic2NyaXB0aW9uIG1ldGFkYXRhXCIgfSxcbiAgICAgICAgICB7IHN0YXR1czogMjAwIH1cbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coYFByb2Nlc3Npbmcgc3Vic2NyaXB0aW9uIGV2ZW50OiAke2V2ZW50LnR5cGV9YCwge1xuICAgICAgICBjdXN0b21lcklkLFxuICAgICAgICB1c2VySWQsXG4gICAgICAgIGV2ZW50SWQ6IGV2ZW50LmlkLFxuICAgICAgICBzdWJzY3JpcHRpb25TdGF0dXM6IHN1YnNjcmlwdGlvbi5zdGF0dXNcbiAgICAgIH0pO1xuXG4gICAgICB0cnkge1xuICAgICAgICAvLyBVc2UgYSB0cmFuc2FjdGlvbiB0byBlbnN1cmUgYm90aCBvcGVyYXRpb25zIHN1Y2NlZWQgb3IgZmFpbCB0b2dldGhlclxuICAgICAgICBhd2FpdCBwcmlzbWEuJHRyYW5zYWN0aW9uKFtcbiAgICAgICAgICAvLyBVcGRhdGUgdGhlIHN1YnNjcmlwdGlvblxuICAgICAgICAgIHByaXNtYS5zdWJzY3JpcHRpb24udXBkYXRlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7IHVzZXJJZCB9LFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICBzdGF0dXM6IHN1YnNjcmlwdGlvbi5zdGF0dXMsXG4gICAgICAgICAgICAgIHN0cmlwZUN1c3RvbWVySWQ6IGN1c3RvbWVySWQsXG4gICAgICAgICAgICAgIHN0cmlwZVN1YnNjcmlwdGlvbklkOiBzdWJzY3JpcHRpb24uaWQsXG4gICAgICAgICAgICAgIHN0cmlwZVByaWNlSWQ6IHN1YnNjcmlwdGlvbi5pdGVtcy5kYXRhWzBdPy5wcmljZS5pZCxcbiAgICAgICAgICAgICAgc3RyaXBlQ3VycmVudFBlcmlvZEVuZDogbmV3IERhdGUoXG4gICAgICAgICAgICAgICAgKHN1YnNjcmlwdGlvbiBhcyBhbnkpLmN1cnJlbnRfcGVyaW9kX2VuZCAqIDEwMDBcbiAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSksXG4gICAgICAgICAgLy8gTWFyayB0aGUgZXZlbnQgYXMgcHJvY2Vzc2VkXG4gICAgICAgICAgcHJpc21hLnByb2Nlc3NlZFN0cmlwZUV2ZW50LmNyZWF0ZSh7XG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgIGV2ZW50SWQ6IGV2ZW50LmlkLFxuICAgICAgICAgICAgICB0eXBlOiBldmVudC50eXBlLFxuICAgICAgICAgICAgICBwcm9jZXNzZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSksXG4gICAgICAgIF0pO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKGBTdWNjZXNzZnVsbHkgcHJvY2Vzc2VkIHN1YnNjcmlwdGlvbiBldmVudCAke2V2ZW50LmlkfWApO1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyByZWNlaXZlZDogdHJ1ZSB9KTtcbiAgICAgIH0gY2F0Y2ggKGRiRXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkRhdGFiYXNlIG9wZXJhdGlvbiBmYWlsZWQ6XCIsIGRiRXJyb3IpO1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgeyBlcnJvcjogXCJGYWlsZWQgdG8gdXBkYXRlIHN1YnNjcmlwdGlvbiBpbiBkYXRhYmFzZVwiIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDIwMCB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gSGFuZGxlIGV2ZW50IHRpY2tldCBwdXJjaGFzZSBjb21wbGV0aW9uXG4gICAgaWYgKGV2ZW50LnR5cGUgPT09IFwiY2hlY2tvdXQuc2Vzc2lvbi5jb21wbGV0ZWRcIikge1xuICAgICAgY29uc3Qgc2Vzc2lvbiA9IGV2ZW50LmRhdGEub2JqZWN0IGFzIFN0cmlwZS5DaGVja291dC5TZXNzaW9uO1xuXG4gICAgICAvLyBIYW5kbGUgc3VjY2Vzc2Z1bCBwYXltZW50IGZvciBldmVudCB0aWNrZXRzXG4gICAgICBpZiAoc2Vzc2lvbi5tb2RlID09PSBcInBheW1lbnRcIiAmJiBzZXNzaW9uLm1ldGFkYXRhPy5ldmVudElkKSB7XG4gICAgICAgIGNvbnN0IHsgZXZlbnRJZCwgdGlja2V0RGV0YWlscyB9ID0gc2Vzc2lvbi5tZXRhZGF0YTtcbiAgICAgICAgY29uc3QgcGFyc2VkVGlja2V0cyA9IEpTT04ucGFyc2UodGlja2V0RGV0YWlscyk7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBhd2FpdCBwcmlzbWEuJHRyYW5zYWN0aW9uKFtcbiAgICAgICAgICAgIC4uLnBhcnNlZFRpY2tldHMubWFwKCh0aWNrZXQ6IGFueSkgPT5cbiAgICAgICAgICAgICAgcHJpc21hLnRpY2tldFRyYW5zYWN0aW9uLmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgZXZlbnRJZDogZXZlbnRJZCxcbiAgICAgICAgICAgICAgICAgIGVtYWlsOiBzZXNzaW9uLmN1c3RvbWVyX2VtYWlsIHx8ICcnLFxuICAgICAgICAgICAgICAgICAgdGlja2V0VHlwZTogdGlja2V0LnR5cGUsXG4gICAgICAgICAgICAgICAgICBxdWFudGl0eTogdGlja2V0LnF1YW50aXR5LFxuICAgICAgICAgICAgICAgICAgcHJpY2VQZXJVbml0OiB0aWNrZXQucHJpY2UsXG4gICAgICAgICAgICAgICAgICB0b3RhbEFtb3VudDogdGlja2V0LnByaWNlICogdGlja2V0LnF1YW50aXR5LFxuICAgICAgICAgICAgICAgICAgc3RhdHVzOiAnY29tcGxldGVkJyxcbiAgICAgICAgICAgICAgICAgIHB1cmNoYXNlRGF0ZTogbmV3IERhdGUoKSxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApXG4gICAgICAgICAgXSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgdGlja2V0IHRyYW5zYWN0aW9uczonLCBlcnJvcik7XG4gICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBGb3Igb3RoZXIgZXZlbnQgdHlwZXMsIGp1c3QgYWNrbm93bGVkZ2UgcmVjZWlwdFxuICAgIGNvbnNvbGUubG9nKGBTdWNjZXNzZnVsbHkgcmVjZWl2ZWQgd2ViaG9vayBldmVudDogJHtldmVudC50eXBlfSAoSUQ6ICR7ZXZlbnQuaWR9KWApO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IHJlY2VpdmVkOiB0cnVlIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBwcm9jZXNzaW5nIHdlYmhvb2s6XCIsIGVycm9yKTtcbiAgICAvLyBSZXR1cm4gMjAwIGZvciBnZW5lcmFsIGVycm9ycyB0byBwcmV2ZW50IHJldHJpZXNcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IGVycm9yOiBcIkludGVybmFsIHNlcnZlciBlcnJvclwiIH0sXG4gICAgICB7IHN0YXR1czogMjAwIH1cbiAgICApO1xuICB9XG59XG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiU3RyaXBlIiwicHJpc21hIiwicnVudGltZSIsImJvZHlQYXJzZXIiLCJzdHJpcGUiLCJwcm9jZXNzIiwiZW52IiwiU1RSSVBFX1NFQ1JFVF9LRVkiLCJhcGlWZXJzaW9uIiwid2ViaG9va1NlY3JldCIsIlNUUklQRV9XRUJIT09LX1NFQ1JFVCIsIlBPU1QiLCJyZXEiLCJzaWduYXR1cmUiLCJoZWFkZXJzIiwiZ2V0IiwiY29uc29sZSIsImVycm9yIiwianNvbiIsInN0YXR1cyIsInJhd0JvZHkiLCJ0ZXh0IiwiZXZlbnQiLCJ3ZWJob29rcyIsImNvbnN0cnVjdEV2ZW50IiwibG9nIiwidHlwZSIsImlkIiwiZXJyIiwibWVzc2FnZSIsInNsaWNlIiwiYm9keUxlbmd0aCIsImxlbmd0aCIsInByb2Nlc3NlZEV2ZW50IiwicHJvY2Vzc2VkU3RyaXBlRXZlbnQiLCJmaW5kVW5pcXVlIiwid2hlcmUiLCJldmVudElkIiwicmVjZWl2ZWQiLCJzdWJzY3JpcHRpb24iLCJkYXRhIiwib2JqZWN0IiwiY3VzdG9tZXJJZCIsImN1c3RvbWVyIiwidXNlcklkIiwibWV0YWRhdGEiLCJzdWJzY3JpcHRpb25JZCIsInN1YnNjcmlwdGlvblN0YXR1cyIsIiR0cmFuc2FjdGlvbiIsInVwZGF0ZSIsInN0cmlwZUN1c3RvbWVySWQiLCJzdHJpcGVTdWJzY3JpcHRpb25JZCIsInN0cmlwZVByaWNlSWQiLCJpdGVtcyIsInByaWNlIiwic3RyaXBlQ3VycmVudFBlcmlvZEVuZCIsIkRhdGUiLCJjdXJyZW50X3BlcmlvZF9lbmQiLCJjcmVhdGUiLCJwcm9jZXNzZWRBdCIsImRiRXJyb3IiLCJzZXNzaW9uIiwibW9kZSIsInRpY2tldERldGFpbHMiLCJwYXJzZWRUaWNrZXRzIiwiSlNPTiIsInBhcnNlIiwibWFwIiwidGlja2V0IiwidGlja2V0VHJhbnNhY3Rpb24iLCJlbWFpbCIsImN1c3RvbWVyX2VtYWlsIiwidGlja2V0VHlwZSIsInF1YW50aXR5IiwicHJpY2VQZXJVbml0IiwidG90YWxBbW91bnQiLCJwdXJjaGFzZURhdGUiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/webhooks/stripe/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/prisma.ts":
/*!***************************!*\
  !*** ./src/lib/prisma.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getPrismaClient: () => (/* binding */ getPrismaClient),\n/* harmony export */   prisma: () => (/* binding */ prisma)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n\nconst globalForPrisma = globalThis;\nconst prisma = globalForPrisma.prisma ?? new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient({\n    log:  true ? [\n        'query',\n        'error',\n        'warn'\n    ] : 0\n});\nif (true) globalForPrisma.prisma = prisma;\nfunction getPrismaClient() {\n    try {\n        if (!prisma) {\n            throw new Error('Prisma client is not initialized');\n        }\n        return prisma;\n    } catch (error) {\n        console.error('Error getting Prisma client:', error);\n        throw new Error('Database connection failed');\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3ByaXNtYS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQTZDO0FBRTdDLE1BQU1DLGtCQUFrQkM7QUFJakIsTUFBTUMsU0FDWEYsZ0JBQWdCRSxNQUFNLElBQ3RCLElBQUlILHdEQUFZQSxDQUFDO0lBQ2ZJLEtBQUtDLEtBQXNDLEdBQUc7UUFBQztRQUFTO1FBQVM7S0FBTyxHQUFHLENBQVM7QUFDdEYsR0FBRTtBQUVKLElBQUlBLElBQXFDLEVBQUVKLGdCQUFnQkUsTUFBTSxHQUFHQTtBQUU3RCxTQUFTRztJQUNkLElBQUk7UUFDRixJQUFJLENBQUNILFFBQVE7WUFDWCxNQUFNLElBQUlJLE1BQU07UUFDbEI7UUFDQSxPQUFPSjtJQUNULEVBQUUsT0FBT0ssT0FBTztRQUNkQyxRQUFRRCxLQUFLLENBQUMsZ0NBQWdDQTtRQUM5QyxNQUFNLElBQUlELE1BQU07SUFDbEI7QUFDRiIsInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxnYWluXFxnaXRcXG5leHRqcy10ZW1wbGF0ZVxcc3JjXFxsaWJcXHByaXNtYS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcmlzbWFDbGllbnQgfSBmcm9tICdAcHJpc21hL2NsaWVudCdcblxuY29uc3QgZ2xvYmFsRm9yUHJpc21hID0gZ2xvYmFsVGhpcyBhcyB1bmtub3duIGFzIHtcbiAgcHJpc21hOiBQcmlzbWFDbGllbnQgfCB1bmRlZmluZWRcbn1cblxuZXhwb3J0IGNvbnN0IHByaXNtYSA9XG4gIGdsb2JhbEZvclByaXNtYS5wcmlzbWEgPz9cbiAgbmV3IFByaXNtYUNsaWVudCh7XG4gICAgbG9nOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50JyA/IFsncXVlcnknLCAnZXJyb3InLCAnd2FybiddIDogWydlcnJvciddLFxuICB9KVxuXG5pZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgZ2xvYmFsRm9yUHJpc21hLnByaXNtYSA9IHByaXNtYVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0UHJpc21hQ2xpZW50KCkge1xuICB0cnkge1xuICAgIGlmICghcHJpc21hKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1ByaXNtYSBjbGllbnQgaXMgbm90IGluaXRpYWxpemVkJylcbiAgICB9XG4gICAgcmV0dXJuIHByaXNtYVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGdldHRpbmcgUHJpc21hIGNsaWVudDonLCBlcnJvcilcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0RhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkJylcbiAgfVxufSJdLCJuYW1lcyI6WyJQcmlzbWFDbGllbnQiLCJnbG9iYWxGb3JQcmlzbWEiLCJnbG9iYWxUaGlzIiwicHJpc21hIiwibG9nIiwicHJvY2VzcyIsImdldFByaXNtYUNsaWVudCIsIkVycm9yIiwiZXJyb3IiLCJjb25zb2xlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/prisma.ts\n");

/***/ }),

/***/ "(ssr)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "../app-render/after-task-async-storage.external":
/*!***********************************************************************************!*\
  !*** external "next/dist/server/app-render/after-task-async-storage.external.js" ***!
  \***********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/after-task-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "./work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

"use strict";
module.exports = require("@prisma/client");

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

"use strict";
module.exports = require("child_process");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("events");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("https");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("util");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/stripe","vendor-chunks/qs","vendor-chunks/object-inspect","vendor-chunks/get-intrinsic","vendor-chunks/side-channel-list","vendor-chunks/side-channel-weakmap","vendor-chunks/has-symbols","vendor-chunks/function-bind","vendor-chunks/side-channel-map","vendor-chunks/side-channel","vendor-chunks/get-proto","vendor-chunks/call-bind-apply-helpers","vendor-chunks/dunder-proto","vendor-chunks/math-intrinsics","vendor-chunks/call-bound","vendor-chunks/es-errors","vendor-chunks/gopd","vendor-chunks/es-define-property","vendor-chunks/hasown","vendor-chunks/es-object-atoms"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fwebhooks%2Fstripe%2Froute&page=%2Fapi%2Fwebhooks%2Fstripe%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fwebhooks%2Fstripe%2Froute.ts&appDir=C%3A%5CUsers%5Cgain%5Cgit%5Cnextjs-template%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cgain%5Cgit%5Cnextjs-template&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();